---
title: ' WSL2 + Emacs + dockerç’°å¢ƒã§PHPã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°'
tags:
- Emacs
- PHP
- é–‹ç™ºç’°å¢ƒ
date: 2020-03-02T22:45:32+09:00
URL: https://wand-ta.hatenablog.com/entry/2020/03/02/224532
EditURL: https://blog.hatena.ne.jp/wand_ta/wand-ta.hatenablog.com/atom/entry/26006613529176690
---

ã“ã®çµ„ã¿åˆã‚ã›ã®è³‡æ–™ãŒè¦‹å½“ãŸã‚‰ãšã€è‹¥å¹²è©°ã¾ã£ãŸã®ã§ãƒ¡ãƒ¢æ›¸ã


-------------------------------------


# ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒª #

- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

[https://github.com/wand2016/timetravel-sample:embed:cite]

- dockerç’°å¢ƒ

[https://github.com/wand2016/docker-php:embed:cite]


# ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ã‚’å‹•ã‹ã™ã¾ã§ #

## ä¿¯ç°å›³ ##

![20200303002002](../../../imgs/20200303002002.png)

## WSL2ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾— ##

- Xdebugã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒphp-fpmã‹ã‚‰è¦‹ã¦`127.0.0.1`ã˜ã‚ƒãªã„ã®ã§ã€èª¿ã¹ã¦è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹

```sh
# on WSL2
ifconfig eth0
```

```
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 172.30.58.210  netmask 255.255.240.0  broadcast 172.30.63.255
...
```

- å¿…è¦ãªã¨ã“ã‚ã ã‘æŠ½å‡º

```sh
ifconfig eth0 | grep 'inet ' | awk '{print $2}'
```

```
172.30.58.210
```

- ã“ã‚Œã¯WSL2ã‚’èµ·å‹•ã™ã‚‹ãŸã³ã«æ¯å›å¤‰ã‚ã‚‹


## Xdebugã®è¨­å®š ##

- php-fpmã‚³ãƒ³ãƒ†ãƒŠã®php.ini (æŠœç²‹)
- ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ã®æœ‰åŠ¹/ç„¡åŠ¹ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‚’ç’°å¢ƒå¤‰æ•°ã§æµã—è¾¼ã‚€

```ini
[xdebug]
zend_extension=xdebug.so
xdebug.remote_enable=${XDEBUG_REMOTE_ENABLE}
xdebug.remote_autostart=off
xdebug.remote_handler=dbgp
xdebug.remote_host=${XDEBUG_REMOTE_ADDRESS}
xdebug.remote_port=9000
xdebug.remote_log=/var/log/php/xdebug.log
```

- php-fpmã‚³ãƒ³ãƒ†ãƒŠã®ç’°å¢ƒå¤‰æ•°

.env

```
...
XDEBUG_REMOTE_ENABLE=1
XDEBUG_REMOTE_ADDRESS=172.30.58.210
...
```


## ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ãŒå‹•ãã“ã¨ã‚’ç¢ºèª ##

- `http://localhost:10080/?XDEBUG_SESSION_START=1` ã«ã‚¢ã‚¯ã‚»ã‚¹

![20200303003334](../../../imgs/20200303003334.png)

ğŸ‰



# ã‚¹ãƒˆãƒ¬ã‚¹ãªããƒ‡ãƒãƒƒã‚°ã‚’é€²ã‚ã‚‹ãŸã‚ã®è¨­å®š #

![20200303003429](../../../imgs/20200303003429.png)

- ãƒ‡ãƒãƒƒã‚°ã—ãŸã„å ´æ‰€ã¾ã§ã‚¹ãƒ†ãƒƒãƒ—ã™ã‚‹ã¨ã‹åœ°ç„ãªã®ã§ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’å¼µã‚ŠãŸã„

![20200303002320](../../../imgs/20200303002320.png)

- ã—ã‹ã—ã€ãƒ‡ãƒãƒƒã‚°ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒé–‹å§‹ã™ã‚‹ãŸã³ã«  
`~/.emacs/geben/<æ¯å›å¤‰ã‚ã‚‹ç•ªå·>/`  
ä¸‹ã«phpä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€ã“ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚‰ã‹ã˜ã‚ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’å¼µã£ã¦ãŠãã“ã¨ã¯ä¸å¯èƒ½
- ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ã«ã¯ã€`geben-path-mappings`å¤‰æ•°ã‚’ä½¿ã†

## geben-path-mappingsã®è¨­å®š ##

![20200303002535](../../../imgs/20200303002535.png)

- `M-x customize-variable RET geben-path-mappings`
- WSL2ãƒ­ãƒ¼ã‚«ãƒ«ä¸Šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã¨ã€dockerã‚³ãƒ³ãƒ†ãƒŠä¸Šã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹
    - ãƒ­ãƒ¼ã‚«ãƒ«: `/home/wand/repos/timetravel`
    - ãƒªãƒ¢ãƒ¼ãƒˆ: `/var/www`
        - ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆãƒªã‚¹ãƒˆã® `file:///var/www/` ã‹ã‚‰ `file://`ã‚¹ã‚­ãƒ¼ãƒã‚’é™¤ã„ãŸã‚‚ã®

![20200303002834](../../../imgs/20200303002834.png)

- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šã§`geben-add-current-line-to-predefined-breakpoints` (é•·ã„) ã‚’å®Ÿè¡Œã—ã¦ãŠãã¨

![20200303002932](../../../imgs/20200303002932.png)

![20200303003033](../../../imgs/20200303003033.png)

- ç„¡äº‹ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’å¼µã‚‹ã“ã¨ãŒå‡ºæ¥ãŸğŸ‰
